# 任務：產生前端網頁

## ⚠️ 最重要的規則

### 1. 檔案位置固定

所有前端檔案必須放在 `src/` 目錄下：

```
src/
├── main.js           # 入口（doGet）- 可修改
├── Index.html        # 主頁面（對應 doGet 的檔名）
├── *.js              # 業務邏輯模組
└── utils/            # 工具函式
```

**絕對不能**在其他位置建立 HTML 檔案。

### 2. main.js 是入口

`main.js` 定義了 `doGet()` 函數，決定載入哪個 HTML 檔案：

```javascript
// src/main.js
function doGet() {
  return HtmlService.createHtmlOutputFromFile('Index')
    .setTitle('應用名稱')
    .setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL);
}
```

- `'Index'` 對應 `src/Index.html`
- 可以修改 `main.js` 來調整標題或設定
- 如需多頁面，可在 `main.js` 加入路由邏輯

### 3. 根據現有實作產生

先閱讀以下檔案來了解後端 API：

```bash
# 查看所有業務函數
ls src/*.js

# 查看 Feature 檔案了解需求
ls features/*.feature
```

---

## 你需要知道的事

### 1. GAS Web App 架構

```
┌─────────────────────────────────────────┐
│  瀏覽器                                 │
│  ┌─────────────────────────────────┐    │
│  │  src/Index.html                 │    │
│  │  - 呼叫 google.script.run       │    │
│  └─────────────────────────────────┘    │
└─────────────────────────────────────────┘
                    │
                    ▼ google.script.run.函數名()
┌─────────────────────────────────────────┐
│  Apps Script 後端                        │
│  ┌─────────────────────────────────┐    │
│  │  src/main.js      (doGet 入口)  │    │
│  │  src/doClock.js   (打卡)        │    │
│  │  src/getRecords.js (查詢)       │    │
│  └─────────────────────────────────┘    │
└─────────────────────────────────────────┘
```

### 2. google.script.run 用法

```javascript
// 呼叫後端函數
google.script.run
  .withSuccessHandler(function(result) {
    // result 是後端回傳的資料
    console.log('成功:', result);
  })
  .withFailureHandler(function(error) {
    console.error('失敗:', error);
  })
  .後端函數名(參數1, 參數2);
```

### 3. 序列化限制（重要！）

**Date 物件無法序列化**，前端會收到 `null`。

```javascript
// ❌ 錯誤：後端回傳 Date 物件
function getRecords() {
  const data = sheet.getDataRange().getValues();  // 包含 Date
  return data;  // 前端收到 null！
}

// ✅ 正確：後端回傳格式化字串
function getRecords() {
  const data = sheet.getDataRange().getDisplayValues();  // 字串
  return data;  // 前端正常收到
}
```

---

## 產生規則

### 1. 基本 HTML 結構

```html
<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>應用名稱</title>
  <style>
    /* 內嵌 CSS */
  </style>
</head>
<body>
  <!-- 內容 -->

  <script>
    // 內嵌 JavaScript
  </script>
</body>
</html>
```

### 2. 呼叫後端 API

根據 `src/*.js` 中的函數來呼叫：

```javascript
// 假設後端有 doClock(type) 函數
function handleClockIn() {
  google.script.run
    .withSuccessHandler(onSuccess)
    .withFailureHandler(onError)
    .doClock('IN');
}

function onSuccess(result) {
  if (result.success) {
    alert(result.message);
    refreshData();
  } else {
    alert('錯誤: ' + result.message);
  }
}

function onError(error) {
  alert('系統錯誤: ' + error.message);
}
```

### 3. 顯示資料

```javascript
// 假設後端有 getTodayRecords() 函數
function loadRecords() {
  google.script.run
    .withSuccessHandler(displayRecords)
    .withFailureHandler(onError)
    .getTodayRecords();
}

function displayRecords(records) {
  const container = document.getElementById('records');
  container.innerHTML = '';

  records.forEach(function(record) {
    const div = document.createElement('div');
    div.textContent = record.type + ' - ' + record.time;
    container.appendChild(div);
  });
}
```

---

## 流程

1. **閱讀 Feature 檔案**了解需求
2. **閱讀 src/*.js**了解後端 API
3. **產生 src/Index.html**
4. **測試**：執行 `npm test` 確認前端測試通過（如果有）

---

## 檢查清單

- [ ] HTML 檔案放在 `src/` 目錄
- [ ] 使用 `google.script.run` 呼叫後端
- [ ] 處理 `withSuccessHandler` 和 `withFailureHandler`
- [ ] 不依賴 Date 物件（使用字串格式）
- [ ] 響應式設計（手機也能用）
- [ ] 清楚的使用者回饋（loading、錯誤訊息）

---

## 輸出

將 HTML 檔案存到 `src/Index.html`

---

**記住**：前端是後端的「使用者」，根據後端 API 來設計 UI。
