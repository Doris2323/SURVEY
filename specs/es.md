# Event Storming: 旅遊規劃工具

## Actors

- **用戶** [人]: 規劃旅遊行程的使用者

## Aggregates

### 旅遊計畫
> 一趟旅行的規劃容器，包含基本資訊與預算設定

| 屬性 | 說明 |
|------|------|
| id | 旅遊計畫唯一識別碼 |
| 計畫名稱 | 如「2024 日本東京行」 |
| 出發日期 | 可選 |
| 結束日期 | 可選 |
| 參與人數 | 預設至少 1 人 |
| 預算上限 | 可選，不填表示無上限 |
| 備註 | 額外說明 |
| 建立時間 | 記錄建立時間點 |

### 住宿選項
> 記錄一個住宿地點的資訊與價格

| 屬性 | 說明 |
|------|------|
| id | 住宿選項唯一識別碼 |
| 旅遊計畫ID | 所屬旅遊計畫（外鍵） |
| 住宿名稱 | 如「台北君悅酒店」 |
| 地點 | 地址或區域 |
| 每晚價格 | 單位：元 |
| 入住天數 | 天數 |
| 總價 | 系統計算（每晚價格 × 入住天數） |
| 備註 | 額外說明 |
| 來源網址 | 訂房網站連結 |

### 交通方式
> 記錄一個交通選項的資訊與費用

| 屬性 | 說明 |
|------|------|
| id | 交通方式唯一識別碼 |
| 旅遊計畫ID | 所屬旅遊計畫（外鍵） |
| 交通類型 | 飛機、高鐵、客運、租車等 |
| 起點 | 出發地點 |
| 終點 | 抵達地點 |
| 費用 | 單位：元（單人票價） |

## Commands

### 建立旅遊計畫
- **Actor**: 用戶
- **Aggregate**: 旅遊計畫
- **Predecessors**: 無
- **參數**: 計畫名稱, 出發日期, 結束日期, 參與人數, 預算上限, 備註
- **Description**:
  - What: 用戶建立一個新的旅遊計畫，作為住宿與交通選項的容器
  - Why: 將相關的旅遊選項組織在同一計畫下，方便管理與計算總花費
  - When: 用戶開始規劃一趟新的旅行時執行

#### Rules
- 前置（狀態）:
  - 計畫名稱不可重複
- 前置（參數）:
  - 計畫名稱必須提供
  - 結束日期必須 ≥ 出發日期（若兩者皆有填）
  - 參與人數必須 ≥ 1
  - 預算上限可選（不填表示無上限）
- 後置（狀態）:
  - 系統新增一筆旅遊計畫記錄

### 新增住宿選項
- **Actor**: 用戶
- **Aggregate**: 住宿選項
- **Predecessors**: 建立旅遊計畫
- **參數**: 旅遊計畫ID, 住宿名稱, 地點, 每晚價格, 入住天數, 備註, 來源網址
- **Description**:
  - What: 用戶將一個住宿選項（地點、價格等資訊）記錄到系統中
  - Why: 方便後續比較不同住宿的花費，並納入整體旅遊預算計算
  - When: 用戶在規劃旅遊時，找到一個潛在的住宿選擇後執行

#### Rules
- 前置（狀態）:
  - 旅遊計畫必須已存在
  - 同一旅遊計畫內住宿名稱不可重複
- 前置（參數）:
  - 住宿名稱必須提供
  - 每晚價格必須大於 0
  - 入住天數必須大於 0
  - 來源網址若填寫需為有效 URL 格式
- 後置（狀態）:
  - 系統新增一筆住宿選項記錄
  - 總價由系統自動計算（每晚價格 × 入住天數）

### 新增交通方式
- **Actor**: 用戶
- **Aggregate**: 交通方式
- **Predecessors**: 建立旅遊計畫
- **參數**: 旅遊計畫ID, 交通類型, 起點, 終點, 費用
- **Description**:
  - What: 用戶將一個交通方式（類型、費用等資訊）記錄到系統中
  - Why: 方便後續比較不同交通的花費，並納入整體旅遊預算計算
  - When: 用戶在規劃旅遊時，找到一個交通選項後執行

#### Rules
- 前置（狀態）:
  - 旅遊計畫必須已存在
  - 同一計畫內相同「類型+起點+終點」不可重複
- 前置（參數）:
  - 交通類型必須提供
  - 起點必須提供
  - 終點必須提供
  - 費用必須大於等於 0
- 後置（狀態）:
  - 系統新增一筆交通方式記錄

## Read Models

### 查詢住宿列表
- **Actor**: 用戶
- **Aggregates**: 住宿選項
- **回傳欄位**: 住宿名稱, 地點, 每晚價格, 入住天數, 總價, 備註, 來源網址
- **Description**:
  - What: 用戶查詢系統中已記錄的所有住宿選項
  - Why: 用戶需要瀏覽已記錄的選項，以便比較或選擇
  - When: 用戶想要回顧或確認已記錄的住宿資訊時執行

#### Rules
- 前置（狀態）:
  - 無
- 前置（參數）:
  - 旅遊計畫ID（可選）
- 後置（回應）:
  - 若指定旅遊計畫ID，回傳該計畫下的住宿列表
  - 若未指定，回傳所有住宿列表
  - 若無住宿記錄，回傳空列表
  - 結果按新增時間排序

### 查詢花費方案分析
- **Actor**: 用戶
- **Aggregates**: 旅遊計畫, 住宿選項, 交通方式
- **回傳欄位**: 住宿名稱, 住宿總價, 交通方式, 交通費用, 組合總花費, 每人平均花費, 是否超過預算
- **Description**:
  - What: 用戶查詢某旅遊計畫下所有住宿與交通的花費組合分析
  - Why: 快速比較不同組合的總花費，協助決策
  - When: 用戶想要評估預算或比較方案時執行

#### Rules
- 前置（狀態）:
  - 無
- 前置（參數）:
  - 旅遊計畫ID（必填）
- 後置（回應）:
  - 列出所有「住宿 × 交通」的組合（笛卡爾積）
  - 每個組合包含：住宿名稱、住宿總價、交通方式、交通費用
  - 組合總花費 = 住宿總價 + (交通費用 × 參與人數)
  - 每人平均花費 = 組合總花費 ÷ 參與人數
  - 標示是否超過預算（若有設定預算上限）
  - 結果按總花費排序（低到高）
  - 若無住宿或交通記錄，回傳空列表
