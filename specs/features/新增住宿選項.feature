Feature: 新增住宿選項

  Background:
    Given 系統中有以下旅遊計畫：
      | id | 計畫名稱       | 參與人數 |
      | 1  | 2024 東京自由行 | 2        |

  # ========== 前置條件 ==========

  Rule: 前置（狀態）- 旅遊計畫必須已存在

    Example: 旅遊計畫不存在時新增失敗
      When 用戶 "Alice" 在旅遊計畫 999 新增住宿選項：
        | 住宿名稱     | 地點 | 每晚價格 | 入住天數 |
        | 東京車站飯店 | 東京 | 3000     | 3        |
      Then 操作失敗
      And 錯誤訊息為 "旅遊計畫不存在"

  Rule: 前置（狀態）- 同一旅遊計畫內住宿名稱不可重複

    Example: 住宿名稱已存在時新增失敗
      Given 旅遊計畫 1 中有以下住宿選項：
        | 住宿名稱     | 地點 | 每晚價格 | 入住天數 |
        | 東京車站飯店 | 東京 | 3000     | 3        |
      When 用戶 "Alice" 在旅遊計畫 1 新增住宿選項：
        | 住宿名稱     | 地點   | 每晚價格 | 入住天數 |
        | 東京車站飯店 | 新宿   | 2500     | 3        |
      Then 操作失敗
      And 錯誤訊息為 "住宿名稱已存在"

  Rule: 前置（參數）- 住宿名稱必須提供

    Example: 未提供住宿名稱時新增失敗
      When 用戶 "Alice" 在旅遊計畫 1 新增住宿選項：
        | 住宿名稱 | 地點 | 每晚價格 | 入住天數 |
        |          | 東京 | 3000     | 3        |
      Then 操作失敗
      And 錯誤訊息為 "住宿名稱必須提供"

  Rule: 前置（參數）- 每晚價格必須大於 0

    Example: 每晚價格為 0 時新增失敗
      When 用戶 "Alice" 在旅遊計畫 1 新增住宿選項：
        | 住宿名稱     | 地點 | 每晚價格 | 入住天數 |
        | 東京車站飯店 | 東京 | 0        | 3        |
      Then 操作失敗
      And 錯誤訊息為 "每晚價格必須大於 0"

  Rule: 前置（參數）- 入住天數必須大於 0

    Example: 入住天數為 0 時新增失敗
      When 用戶 "Alice" 在旅遊計畫 1 新增住宿選項：
        | 住宿名稱     | 地點 | 每晚價格 | 入住天數 |
        | 東京車站飯店 | 東京 | 3000     | 0        |
      Then 操作失敗
      And 錯誤訊息為 "入住天數必須大於 0"

  Rule: 前置（參數）- 來源網址若填寫需為有效 URL 格式

    Example: 來源網址格式錯誤時新增失敗
      When 用戶 "Alice" 在旅遊計畫 1 新增住宿選項：
        | 住宿名稱     | 地點 | 每晚價格 | 入住天數 | 來源網址       |
        | 東京車站飯店 | 東京 | 3000     | 3        | not-a-valid-url |
      Then 操作失敗
      And 錯誤訊息為 "來源網址格式錯誤"

  # ========== 後置條件 ==========

  Rule: 後置（狀態）- 系統應新增一筆住宿選項記錄

    Example: 成功新增住宿選項（完整資訊）
      When 用戶 "Alice" 在旅遊計畫 1 新增住宿選項：
        | 住宿名稱     | 地點 | 每晚價格 | 入住天數 | 備註       | 來源網址                    |
        | 東京車站飯店 | 東京 | 3000     | 3        | 交通方便   | https://booking.com/tokyo1  |
      Then 操作成功
      And 旅遊計畫 1 中應有以下住宿選項：
        | 住宿名稱     | 地點 | 每晚價格 | 入住天數 | 總價  | 備註       | 來源網址                    |
        | 東京車站飯店 | 東京 | 3000     | 3        | 9000  | 交通方便   | https://booking.com/tokyo1  |

  Rule: 後置（狀態）- 總價由系統自動計算

    Example: 總價等於每晚價格乘以入住天數
      When 用戶 "Alice" 在旅遊計畫 1 新增住宿選項：
        | 住宿名稱   | 地點 | 每晚價格 | 入住天數 |
        | 新宿王子   | 新宿 | 2500     | 5        |
      Then 操作成功
      And 旅遊計畫 1 中應有以下住宿選項：
        | 住宿名稱   | 每晚價格 | 入住天數 | 總價  |
        | 新宿王子   | 2500     | 5        | 12500 |
