# language: en
@e2e
Feature: 頁面流程
  作為一個使用者
  我想要透過網頁介面進行打卡
  以便方便記錄上下班時間

  Background:
    Given 系統已準備好「打卡記錄」工作表

  # ========== 前置條件 - 參數驗證 ==========

  Rule: 前置條件 - 必須先有 IN 記錄才能點 OUT 按鈕（否則顯示錯誤）

    Example: 未上班就點擊下班按鈕顯示錯誤
      When 我開啟打卡頁面
      And 我點擊「OUT 下班」按鈕
      Then 頁面應該顯示錯誤訊息「請先完成 IN 打卡」
      And 頁面應該顯示 0 筆打卡記錄

  # ========== 前置條件 - 狀態驗證 ==========

  Rule: 前置條件 - 必須先有 OUT 記錄才能再點 IN 按鈕（否則顯示錯誤）

    Example: 連續點擊上班按鈕顯示錯誤
      Given 已有一筆打卡記錄：類型「IN」時間「2026/1/27上午9:00:00」
      When 我開啟打卡頁面
      And 我點擊「IN 上班」按鈕
      Then 頁面應該顯示錯誤訊息「請先完成 OUT 打卡」
      And 頁面應該顯示 1 筆打卡記錄

  # ========== 後置條件 ==========

  Rule: 後置條件 - 頁面載入時應顯示所有 UI 元素

    Example: 載入頁面
      When 我開啟打卡頁面
      Then 頁面應該顯示「打卡系統」標題
      And 頁面應該有「IN 上班」按鈕
      And 頁面應該有「OUT 下班」按鈕
      And 頁面應該顯示累計工時「0 分鐘」

  Rule: 後置條件 - 頁面載入時應顯示今日已有記錄
  
  # 📋 澄清決策 (2026-01-27):
  # - 記錄以時間倒序排列（最新在上）
  # - 原因：使用者最關心最新的打卡狀態
  # - 實作：getTodayRecords() 返回 records.reverse()

    Example: 頁面載入今日記錄
      Given 已有一筆打卡記錄：類型「IN」時間「2026/1/27上午9:00:00」
      When 我開啟打卡頁面
      Then 頁面應該顯示 1 筆打卡記錄
      And 頁面應該顯示記錄「IN - 2026/1/27上午9:00:00」

  Rule: 後置條件 - 點擊 IN 按鈕應新增記錄並顯示成功訊息

    Example: 點擊上班打卡按鈕
      Given 目前時間是「2026/1/27上午9:00:00」
      When 我開啟打卡頁面
      And 我點擊「IN 上班」按鈕
      Then 頁面應該顯示成功訊息「上班打卡成功」
      And 頁面應該顯示 1 筆打卡記錄
      And 頁面應該顯示記錄「IN - 2026/1/27上午9:00:00」

  Rule: 後置條件 - 點擊 OUT 按鈕應新增記錄並顯示成功訊息

    Example: 點擊下班打卡按鈕
      Given 已有一筆打卡記錄：類型「IN」時間「2026/1/27上午9:00:00」
      And 目前時間是「2026/1/27下午6:00:00」
      When 我開啟打卡頁面
      And 我點擊「OUT 下班」按鈕
      Then 頁面應該顯示成功訊息「下班打卡成功」
      And 頁面應該顯示 2 筆打卡記錄
      And 頁面應該顯示記錄「OUT - 2026/1/27下午6:00:00」

  Rule: 後置條件 - 累計工時應為所有 IN/OUT 配對的時間差總和

    Scenario Outline: 顯示累計工時
      Given 已有一筆打卡記錄：類型「IN」時間「<上班時間>」
      And 已有一筆打卡記錄：類型「OUT」時間「<下班時間>」
      When 我開啟打卡頁面
      Then 頁面應該顯示累計工時「<預期工時>」

      Examples:
        | 上班時間              | 下班時間               | 預期工時   |
        | 2026/1/27上午9:00:00  | 2026/1/27下午6:00:00   | 540 分鐘   |
        | 2026/1/27上午9:00:00  | 2026/1/27上午11:00:00  | 120 分鐘   |
        | 2026/1/27上午8:30:00  | 2026/1/27下午5:30:00   | 540 分鐘   |

  Rule: 後置條件 - 網頁 API 應回傳今日所有打卡記錄與累計工時

    Example: 網頁 API 回傳打卡記錄
      Given 已有一筆打卡記錄：類型「IN」時間「2026/1/27上午9:00:00」
      And 已有一筆打卡記錄：類型「OUT」時間「2026/1/27下午6:00:00」
      When 我透過網頁查詢今日打卡
      Then 應該回傳打卡記錄和累計工時
      And 打卡記錄應該有 2 筆
      And 第 1 筆記錄的類型應該是「IN」
      And 第 1 筆記錄的時間應該是「2026/1/27上午9:00:00」
      And 第 2 筆記錄的類型應該是「OUT」
      And 第 2 筆記錄的時間應該是「2026/1/27下午6:00:00」
      And 累計工時應該是 540 分鐘

  Rule: 後置條件 - 無記錄時 API 應回傳空陣列與零工時

    Example: 網頁 API 回傳空記錄
      When 我透過網頁查詢今日打卡
      Then 應該回傳打卡記錄和累計工時
      And 打卡記錄應該有 0 筆
      And 累計工時應該是 0 分鐘

  Rule: 後置條件 - API 回傳資料應正確序列化為文字格式

    Example: 網頁 API 回傳的資料應該可以正確傳遞到前端
      Given 已有一筆打卡記錄：類型「IN」時間「2026/1/27上午9:00:00」
      When 我透過前端呼叫後端查詢今日打卡
      Then 前端應該收到有效的回傳值
      And 第 1 筆記錄的時間應該是文字格式「2026/1/27上午9:00:00」
